var request = require('request');
var parseString = require('xml2js').parseString;

request('http://weather.livedoor.com/forecast/rss/primary_area.xml', function (error, response, body) {
  if (!error && response.statusCode == 200) {
    var xml = body;
    parseString(xml, function (err, result) {
      //var r = result.rss.channel;
      var r = result.rss.channel[0]['ldWeather:source'][0].pref;
      //console.dir(r);

      var prefs = [];
      r.forEach(pref => {
        var cities = pref.city.map(city => {
          return {
            title: city['$'].title,
            id: city['$'].id,
            //source: city['$'].source,
          };
        });
        prefs.push({
          title: pref['$'].title,
          cities: cities,
        });
      });
      console.log(JSON.stringify(prefs, null, 2));
    });
  }
});



